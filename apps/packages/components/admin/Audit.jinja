{#def request, user, title="Audit Log", logs=[] #}
{#import "../layouts/Admin.jinja" as AdminLayout #}
{#import "../ui/Badge.jinja" as Badge #}
{#import "../ui/EmptyState.jinja" as EmptyState #}

<AdminLayout request={{ request }} user={{ user }} title={{ title }} current_page="audit">
  <div class="space-y-6">
    <header>
      <h1 class="text-2xl font-bold text-white mb-1">Audit Log</h1>
      <p class="text-sm text-gray-400">Recent administrative actions across posts, projects, profile, and settings.</p>
    </header>

    {% if logs %}
    <div class="overflow-x-auto rounded-lg border border-gray-800 bg-gray-900/50">
      <table class="w-full text-sm text-left">
        <thead class="text-xs uppercase text-gray-500 border-b border-gray-800">
          <tr>
            <th class="px-4 py-3">When</th>
            <th class="px-4 py-3">Actor</th>
            <th class="px-4 py-3">Action</th>
            <th class="px-4 py-3">Entity</th>
            <th class="px-4 py-3">Entity ID</th>
            <th class="px-4 py-3">Payload</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-800">
          {% for item in logs %}
          <tr class="hover:bg-gray-800/40">
            <td class="px-4 py-3 text-xs text-gray-400 whitespace-nowrap">
              {{ item.created_at }}
            </td>
            <td class="px-4 py-3 text-gray-200">{{ item.actor }}</td>
            <td class="px-4 py-3">
              <Badge
                text={{ item.action }}
                color={{ 'green' if item.action in ['create', 'sync', 'restore'] else ('yellow' if item.action in ['update'] else 'red') }}
                size="sm"
              />
            </td>
            <td class="px-4 py-3 text-gray-300">{{ item.entity }}</td>
            <td class="px-4 py-3 text-xs text-gray-500">{{ item.entity_id or '-' }}</td>
            <td class="px-4 py-3 text-xs text-gray-400 max-w-sm">
              <pre class="whitespace-pre-wrap break-words">{{ item.payload_preview }}</pre>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <EmptyState message="No audit events yet." />
    {% endif %}
  </div>
</AdminLayout>
