{#def request, user, title="Files", files=[] #}
{#import "../layouts/Admin.jinja" as AdminLayout #}
{#import "../ui/EmptyState.jinja" as EmptyState #}
{#import "../ui/Button.jinja" as Button #}

<AdminLayout request={{ request }} user={{ user }} title={{ title }} current_page="files">
  <div class="space-y-6">
    <header>
      <h1 class="text-2xl font-bold text-white mb-1">Files</h1>
      <p class="text-sm text-gray-400">Upload and review static files used by the sites.</p>
    </header>

    <section class="rounded-lg border border-gray-800 bg-gray-900/50 p-4">
      <form method="post" action="/admin/files" enctype="multipart/form-data" class="flex flex-col sm:flex-row gap-3 sm:items-center">
        <input
          type="file"
          name="file"
          required
          class="w-full rounded-md bg-gray-900 border border-gray-700 text-white px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-accent/30 focus:border-accent file:mr-3 file:rounded file:border-0 file:bg-gray-800 file:text-gray-300 file:px-3 file:py-1.5 hover:file:bg-gray-700"
        />
        <Button type="submit" variant="primary">Upload</Button>
      </form>
      <p class="mt-2 text-xs text-gray-500">Files are stored in `apps/packages/static/uploads/files`.</p>
    </section>

    {% if files %}
    <div class="overflow-x-auto rounded-lg border border-gray-800 bg-gray-900/50">
      <table class="w-full text-sm text-left">
        <thead class="text-xs uppercase text-gray-500 border-b border-gray-800">
          <tr>
            <th class="px-4 py-3">File</th>
            <th class="px-4 py-3">Folder</th>
            <th class="px-4 py-3">Size</th>
            <th class="px-4 py-3">Updated</th>
            <th class="px-4 py-3">URL</th>
            <th class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-800">
          {% for item in files %}
          <tr class="hover:bg-gray-800/40">
            <td class="px-4 py-3 text-gray-200">{{ item.name }}</td>
            <td class="px-4 py-3 text-gray-400">{{ item.folder }}</td>
            <td class="px-4 py-3 text-gray-400">{{ item.size_human }}</td>
            <td class="px-4 py-3 text-xs text-gray-500">{{ item.updated_at }}</td>
            <td class="px-4 py-3">
              <a href={{ item.url }} target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs">
                {{ item.url }}
              </a>
            </td>
            <td class="px-4 py-3 text-right">
              <form method="post" action="/admin/files/delete" class="inline">
                <input type="hidden" name="path" value={{ item.path }} />
                <button type="submit" class="text-red-400 hover:text-red-300 text-xs">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <EmptyState message="No uploaded files yet." />
    {% endif %}
  </div>
</AdminLayout>
