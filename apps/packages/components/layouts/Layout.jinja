{#import "@ui/layouts/Content.jinja" as Content #}
{#import "@ui/layouts/Footer.jinja" as Footer #}
{#import "@ui/layouts/Navbar.jinja" as Navbar #}
{#import "@ui/partials/Breadcrumb.jinja" as Breadcrumb #}
{#def
  title="Fabio Souza",
  lang="en",
  description="",
  navbar_links=None,
  brand=None,
  breadcrumb=None
#}

<!doctype html>
<html lang="{{ lang }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  {% if description %}
    <meta name="description" content="{{ description }}" />
  {% endif %}
  <title>{{ title }}</title>

  <script>
    tailwind = { config: { darkMode: 'class' } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@2.0.4"></script>
  <script src="https://unpkg.com/idiomorph@0.3.0/dist/idiomorph-ext.min.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <style>[x-cloak]{ display:none !important; }</style>
</head>

<body
  class="flex min-h-screen flex-col bg-zinc-50 text-zinc-900 dark:bg-zinc-950 dark:text-zinc-50"
  hx-ext="morph"
  x-data="{ dark: false }"
  x-init="
    const saved = localStorage.getItem('theme');
    dark = saved ? saved === 'dark' : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
    const root = document.documentElement;
    if (dark) root.classList.add('dark');
    $watch('dark', v => {
      if (v) root.classList.add('dark'); else root.classList.remove('dark');
      localStorage.setItem('theme', v ? 'dark' : 'light');
    });
  "
>
  <Navbar brand={{ brand or title }} links={{ navbar_links }} />

  <Content>
    <div class="mx-auto w-full max-w-6xl px-4 py-6">
      {% if breadcrumb %}
        <Breadcrumb items={{ breadcrumb }} />
      {% endif %}
      {{ content }}
    </div>
  </Content>

  <Footer brand={{ brand or title }} />

  {# Portals for HTMX-injected content #}
  <div id="modal-portal"></div>
  <div id="toast-portal"></div>

  <script>
    document.body.addEventListener('htmx:afterSwap', (e) => {
      if (window.Alpine) window.Alpine.initTree(e.target);
    });
  </script>
</body>
</html>
