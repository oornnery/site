{#def request, user=None, profile=None, projects=[], posts=[], settings=None #}
{#import "../layouts/Home.jinja" as HomeLayout #}
{#import "../profile/Header.jinja" as ProfileHeader #}
{#import "../ui/Card.jinja" as Card #}
{#import "../ui/Tag.jinja" as Tag #}
{#import "../ui/Input.jinja" as Input #}
{#import "../ui/Button.jinja" as Button #}
{#import "../profile/SocialLinks.jinja" as SocialLinks #}

<HomeLayout request={{ request }} user={{ user }} title="Home" settings={{ settings }}>
    {% set bg_url = settings.home_background_url if settings and settings.home_background_url else None %}
    {# Hero Section #}
    <section class="snap-section">
        <div class="snap-section-content">
            <div
                class="rounded-2xl border border-white/5 bg-black/60 p-6 sm:p-8 backdrop-blur"
                {% if bg_url %}
                style="background-image: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url('{{ bg_url }}'); background-size: cover; background-position: center;"
                {% endif %}
            >
                <ProfileHeader profile={{ profile }} show_resume_link=False />
            </div>
            <div class="mt-4 flex justify-center sm:justify-start">
                <a href="/about" class="inline-flex items-center text-sm text-gray-400 hover:text-white transition-colors">
                    View full resume &rarr;
                </a>
            </div>
        </div>
        {# Scroll indicator #}
        <div class="scroll-indicator">
            <span class="text-xs uppercase tracking-wider">Scroll</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
            </svg>
        </div>
    </section>

    {# Projects & Blog Grid #}
    <section class="snap-section">
        <div class="snap-section-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                {# Projects Column - only shown if enabled #}
                {% if not settings or settings.projects_enabled %}
                <section class="flex flex-col min-h-0">
                    <a href="/projects" class="group block mb-3">
                        <h2
                            class="text-lg font-semibold text-white flex items-center gap-2 group-hover:text-blue-400 transition-colors">
                            Projects
                        </h2>
                    </a>
                    <div class="space-y-3 flex-1 overflow-hidden">
                        {% for project in projects[:3] %}
                        <Card href={{ "/projects/" ~ project.slug }} padding="sm">
                            <div class="flex flex-col gap-1">
                                <h3
                                    class="text-sm text-white font-medium group-hover:text-blue-400 transition-colors line-clamp-1">
                                    {{ project.title }}
                                </h3>
                                <p class="text-xs text-gray-500 line-clamp-1">{{ project.description }}</p>
                                <div class="flex flex-wrap gap-1.5 mt-1">
                                    {% for tech in project.tech_stack[:3] %}
                                    <Tag text={{ tech }} />
                                    {% endfor %}
                                </div>
                            </div>
                        </Card>
                        {% else %}
                        <p class="text-sm text-gray-500">No projects yet.</p>
                        {% endfor %}
                    </div>
                    <a href="/projects"
                        class="inline-block text-xs text-gray-500 hover:text-white transition-colors mt-3">
                        View more projects &rarr;
                    </a>
                </section>
                {% endif %}

                {# Blog Column - only shown if enabled #}
                {% if not settings or settings.blog_enabled %}
                <section class="flex flex-col min-h-0">
                    <a href="{{ PUBLIC_BLOG_URL }}" class="group block mb-3">
                        <h2
                            class="text-lg font-semibold text-white flex items-center gap-2 group-hover:text-blue-400 transition-colors">
                            Blog
                        </h2>
                    </a>
                    <div class="space-y-3 flex-1 overflow-hidden">
                        {% for post in posts[:3] %}
                        <Card href={{ PUBLIC_BLOG_URL ~ "/posts/" ~ post.slug }} padding="sm">
                            <div class="flex flex-col gap-1">
                                <h3
                                    class="text-sm text-white font-medium group-hover:text-blue-400 transition-colors line-clamp-1">
                                    {{ post.title }}
                                </h3>
                                <p class="text-xs text-gray-500 line-clamp-1">{{ post.description }}</p>
                                <div class="flex flex-wrap gap-1.5 mt-1">
                                    {% for tag in post.tags[:3] %}
                                    <Tag text={{ tag }} />
                                    {% endfor %}
                                </div>
                            </div>
                        </Card>
                        {% else %}
                        <p class="text-sm text-gray-500">No posts yet.</p>
                        {% endfor %}
                    </div>
                    <a href="{{ PUBLIC_BLOG_URL }}" class="inline-block text-xs text-gray-500 hover:text-white transition-colors mt-3">
                        Read all posts &rarr;
                    </a>
                </section>
                {% endif %}
            </div>
        </div>
        {# Scroll indicator #}
        <div class="scroll-indicator">
            <span class="text-xs uppercase tracking-wider">Scroll</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
            </svg>
        </div>
    </section>

    {# Contact Section #}
    <section class="snap-section">
        <div class="snap-section-content">
            <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Contact</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 md:gap-12">
                <div>
                    <h3 class="text-base sm:text-lg font-medium text-white mb-3 sm:mb-4">Connect</h3>
                    <div class="flex flex-col gap-3 sm:gap-4">
                        <SocialLinks profile={{ profile }} variant="list" />
                    </div>
                </div>

                <div>
                    <h3 class="text-base sm:text-lg font-medium text-white mb-3 sm:mb-4">Send a Message</h3>
                    <form class="space-y-3 sm:space-y-4" hx-post="/partials/contact/form" hx-swap="outerHTML">
                        <Input name="name" label="Name" placeholder="Your Name" required />
                        <Input name="email" type="email" label="Email" placeholder="your@email.com" required />
                        <Input name="message" type="textarea" label="Message" placeholder="Your message..." rows="4"
                            required />
                        <Button type="submit" variant="primary">Send Message</Button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</HomeLayout>
